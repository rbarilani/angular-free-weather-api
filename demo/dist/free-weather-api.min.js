/**
 * angular-free-weather-api
 * @version v0.0.1 - 2015-06-07
 * @link https://github.com/rbarilani/free-weather-api
 * @author Ruben Barilani <ruben.barilani.dev@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */

"use strict";angular.module("rbarilani.freeWeatherApi",[]).constant("FREE_WEATHER_API_DEFAULT_PARAMETERS",{version:"v1",premium:!1,url:"http://api.worldweatheronline.com",method:"jsonp",endPoints:{localWeather:"/weather.ashx",skyAndMountainWeather:"/sky.ashx",marineWeather:"/marine.ashx",timezone:"/tz.ashx",search:"/search.ashx",pastWeather:"/past-weather.ashx"},params:{includelocation:"yes"}}).provider("freeWeatherApi",["FREE_WEATHER_API_DEFAULT_PARAMETERS",function(a){var b,c=this,d=a,e=d,f={url:function(a){return e.url+"/"+(e.premium?"premium":"free")+"/"+e.version+a},config:function(a,b,d){var f,g=b||{},h=angular.copy(e.params);return g.format="json","jsonp"===e.method&&(g.callback="JSON_CALLBACK"),f=angular.extend({key:c.getApiKey(),q:a},angular.extend(h,g)),angular.extend({params:f},d||{})}};return c.setParameters=function(a){return e=angular.extend(d,a),c},c.setApiKey=function(a){return b=a,c},c.getApiKey=function(){return b},c.$get=["$q","$http","$rootScope",function(a,b,d){function g(c){return function(d,g,h){var i=f.config(d,g,h),j=a.defer(),k=j.promise,l=e.method,m="search_api";return k.$data={},b[l](c,i).then(function(a){var b;return a.data&&a.data.data&&a.data.data.error?(a.status=400,void j.reject({error:angular.copy(a.data.data.error),originalResponse:a})):(b=a.data.data?angular.copy(a.data.data):a.data[m]&&a.data[m].result?angular.copy(a.data[m].result):angular.copy(a.data),angular.extend(k.$data,b),void j.resolve({data:b,originalResponse:a}))})["catch"](function(a){j.reject({error:[{msg:"Unknown error! "}],originalResponse:a})}),k}}if(!angular.isString(c.getApiKey()))throw new Error("You must provide a valid Free Weather Api Key, actual is : "+c.getApiKey());var h=e.endPoints,i={localWeather:f.url(h.localWeather),skyAndMountainWeather:f.url(h.skyAndMountainWeather),marineWeather:f.url(h.marineWeather),timezone:f.url(h.timezone),search:f.url(h.search),pastWeather:f.url(h.pastWeather)},j={};return j.localWeather=function(a,b,c){},j.skyAndMountainWeather=function(a,b,c){},j.marineWeather=function(a,b,c){},j.timezone=function(a,b,c){},j.search=function(a,b,c){},j.pastWeather=function(a,b,c){},angular.forEach(i,function(a,b){j[b]=g(a)}),j.getApiKey=function(){return c.getApiKey()},j}],c}]);